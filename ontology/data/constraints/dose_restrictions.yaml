# Dose restrictions (generates DOSE_CONSTRAINT axioms)
# Defines categorical safety levels for substances in specific patient states
# These are formal safety bounds enforced in verification
# Uses categories (not numeric values) for rigorous formal verification

relation_type: requires_dose_adjustment

relations:
  # Renal impairment safety bounds
  - id: metformin_moderate_renal
    source_id: metformin
    target_id: moderate_renal_impairment
    dose_category: reduced
    strength: strong
    evidence: "Risk of lactic acidosis with reduced renal clearance when eGFR 30-44"

  - id: glyburide_mild_renal
    source_id: glyburide
    target_id: mild_renal_impairment
    dose_category: use_with_caution
    strength: moderate
    evidence: "Hypoglycemia risk from reduced clearance when eGFR 45-59"

  - id: glyburide_moderate_renal
    source_id: glyburide
    target_id: moderate_renal_impairment
    dose_category: severely_restricted
    strength: strong
    evidence: "High hypoglycemia risk from reduced clearance when eGFR 30-44"

  # Hepatic impairment safety bounds
  - id: metformin_hepatic
    source_id: metformin
    target_id: hepatic_impairment
    dose_category: reduced
    strength: strong
    evidence: "Lactic acidosis risk with hepatic dysfunction"

  # Pediatric safety bounds
  - id: metformin_adolescent
    source_id: metformin
    target_id: pediatric_adolescent
    dose_category: use_with_caution
    strength: moderate
    evidence: "Requires weight-based dosing for ages 10-17"

  # Geriatric safety bounds
  - id: metformin_geriatric
    source_id: metformin
    target_id: geriatric
    dose_category: reduced
    strength: moderate
    evidence: "Increased lactic acidosis risk due to age-related renal decline"

  - id: glyburide_geriatric
    source_id: glyburide
    target_id: geriatric
    dose_category: severely_restricted
    strength: strong
    evidence: "Severe hypoglycemia risk in elderly"

  # Pregnancy safety bounds - diabetes medications
  - id: insulin_pregnancy
    source_id: insulin
    target_id: pregnant
    dose_category: standard
    strength: strong
    evidence: "Preferred for glycemic control in pregnancy; does not cross placenta"

  - id: metformin_pregnancy
    source_id: metformin
    target_id: pregnant
    dose_category: use_with_caution
    strength: strong
    evidence: "Use lowest effective dose; high doses increase lactic acidosis risk"

  - id: glyburide_pregnancy
    source_id: glyburide
    target_id: pregnant
    dose_category: reduced
    strength: moderate
    evidence: "Crosses placenta; use lowest effective dose to minimize fetal hypoglycemia"

  - id: glyburide_first_trimester
    source_id: glyburide
    target_id: first_trimester
    dose_category: avoid_if_possible
    strength: strong
    evidence: "Sulfonylureas may cross placenta; prefer insulin or metformin in first trimester"

  # Pregnancy safety bounds - hypertension medications
  - id: labetalol_pregnancy
    source_id: labetalol
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Monitor for maternal-fetal effects; preferred beta-blocker in pregnancy"

  - id: methyldopa_pregnancy
    source_id: methyldopa
    target_id: pregnant
    dose_category: standard
    strength: strong
    evidence: "First-line antihypertensive in pregnancy; long safety record"

  - id: nifedipine_pregnancy
    source_id: nifedipine
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Safe in pregnancy; avoid sublingual administration"

  - id: amlodipine_pregnancy
    source_id: amlodipine
    target_id: pregnant
    dose_category: reduced
    strength: moderate
    evidence: "Limited pregnancy data; prefer labetalol, methyldopa, or nifedipine"

  # Pregnancy safety bounds - HIV medications
  - id: tenofovir_pregnancy
    source_id: tenofovir
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Preferred NRTI backbone in pregnancy; monitor renal function"

  - id: dolutegravir_pregnancy
    source_id: dolutegravir
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Preferred integrase inhibitor; low neural tube defect risk after first trimester"

  - id: dolutegravir_first_trimester
    source_id: dolutegravir
    target_id: first_trimester
    dose_category: reduced
    strength: strong
    evidence: "Small increased neural tube defect risk; discuss alternatives with patient"

  - id: efavirenz_pregnancy
    source_id: efavirenz
    target_id: pregnant
    dose_category: reduced
    strength: moderate
    evidence: "Can continue if virally suppressed; avoid initiating in pregnancy"

  - id: efavirenz_first_trimester
    source_id: efavirenz
    target_id: first_trimester
    dose_category: avoid_if_possible
    strength: strong
    evidence: "Historical neural tube defect concern; switch to dolutegravir if possible"

  # Weight-based safety bounds
  - id: tenofovir_low_weight
    source_id: tenofovir
    target_id: low_body_weight
    dose_category: reduced
    strength: moderate
    conditions:
      - weight_below_50kg
    evidence: "Toxicity risk in low body weight patients"

  # HIV drugs - renal impairment
  - id: tenofovir_moderate_renal
    source_id: tenofovir
    target_id: moderate_renal_impairment
    dose_category: severely_restricted
    strength: strong
    evidence: "Nephrotoxicity risk with reduced clearance when eGFR 30-49"

  # Common medication + renal impairment scenarios
  - id: lisinopril_moderate_renal
    source_id: lisinopril
    target_id: moderate_renal_impairment
    dose_category: severely_restricted
    strength: strong
    evidence: "Hyperkalemia and acute kidney injury risk when eGFR 30-44"

  - id: lisinopril_mild_renal
    source_id: lisinopril
    target_id: mild_renal_impairment
    dose_category: reduced
    strength: moderate
    evidence: "Reduced clearance requires dose adjustment when eGFR 45-59"

  # Heart failure safety bounds
  - id: lisinopril_heart_failure
    source_id: lisinopril
    target_id: heart_failure
    dose_category: use_with_caution
    strength: moderate
    evidence: "Hypotension risk in severe heart failure at high doses"

  - id: metformin_heart_failure
    source_id: metformin
    target_id: heart_failure
    dose_category: severely_restricted
    strength: strong
    evidence: "Lactic acidosis risk in decompensated heart failure"

  # Hypertension medication safety
  - id: losartan_moderate_renal
    source_id: losartan
    target_id: moderate_renal_impairment
    dose_category: reduced
    strength: moderate
    evidence: "Hyperkalemia risk with reduced renal clearance"

  - id: labetalol_asthma
    source_id: labetalol
    target_id: asthma
    dose_category: avoid_if_possible
    strength: moderate
    evidence: "Bronchospasm risk - consider alternatives first"

  # HIV treatment + comorbidity
  - id: efavirenz_hepatic
    source_id: efavirenz
    target_id: hepatic_impairment
    dose_category: reduced
    strength: moderate
    evidence: "Hepatotoxicity and CNS effects with impaired metabolism"

  # Elderly dose restrictions (age_over_65)
  - id: metformin_elderly
    source_id: metformin
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased risk of lactic acidosis; monitor renal function closely"

  - id: glyburide_elderly
    source_id: glyburide
    target_id: age_over_65
    dose_category: avoid_if_possible
    strength: strong
    evidence: "High hypoglycemia risk in elderly; prefer alternatives"

  - id: glipizide_elderly
    source_id: glipizide
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Increased hypoglycemia risk; start with lower doses"

  - id: insulin_elderly
    source_id: insulin
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Reduced insulin clearance; titrate carefully"

  - id: lisinopril_elderly
    source_id: lisinopril
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Increased hypotension risk; start low, go slow"

  - id: amlodipine_elderly
    source_id: amlodipine
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Increased half-life in elderly; start with 2.5mg daily"

  # Breastfeeding dose restrictions
  - id: metformin_breastfeeding
    source_id: metformin
    target_id: breastfeeding
    dose_category: use_with_caution
    strength: moderate
    evidence: "Excreted in breast milk; monitor infant for hypoglycemia"

  - id: insulin_breastfeeding
    source_id: insulin
    target_id: breastfeeding
    dose_category: standard
    strength: moderate
    evidence: "Compatible with breastfeeding; does not pass into milk"

  - id: labetalol_breastfeeding
    source_id: labetalol
    target_id: breastfeeding
    dose_category: use_with_caution
    strength: moderate
    evidence: "Excreted in breast milk; monitor infant for bradycardia"

  - id: methyldopa_breastfeeding
    source_id: methyldopa
    target_id: breastfeeding
    dose_category: standard
    strength: moderate
    evidence: "Compatible with breastfeeding; preferred antihypertensive"

  - id: tenofovir_breastfeeding
    source_id: tenofovir
    target_id: breastfeeding
    dose_category: use_with_caution
    strength: moderate
    evidence: "Excreted in breast milk; weigh risks vs benefits"

  # Chronic kidney disease restrictions (using CKD as target)
  - id: metformin_ckd
    source_id: metformin
    target_id: chronic_kidney_disease
    dose_category: reduced
    strength: strong
    evidence: "Dose reduction required based on eGFR stage"

  - id: glyburide_ckd
    source_id: glyburide
    target_id: chronic_kidney_disease
    dose_category: avoid_if_possible
    strength: strong
    evidence: "Prolonged hypoglycemia risk due to reduced clearance"

  - id: tenofovir_ckd
    source_id: tenofovir
    target_id: chronic_kidney_disease
    dose_category: reduced
    strength: strong
    evidence: "Nephrotoxic; requires dose adjustment and close monitoring"

  - id: lisinopril_ckd
    source_id: lisinopril
    target_id: chronic_kidney_disease
    dose_category: reduced
    strength: moderate
    evidence: "Reduced clearance; monitor potassium and eGFR"

  - id: enalapril_ckd
    source_id: enalapril
    target_id: chronic_kidney_disease
    dose_category: reduced
    strength: moderate
    evidence: "Reduced clearance; monitor potassium and eGFR"

  # Asthma/COPD drug restrictions
  - id: budesonide_pregnancy
    source_id: budesonide
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Generally safe but use lowest effective dose"

  - id: albuterol_pregnancy
    source_id: albuterol
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Preferred bronchodilator in pregnancy"

  - id: tiotropium_renal
    source_id: tiotropium
    target_id: severe_renal_impairment
    dose_category: use_with_caution
    strength: moderate
    evidence: "Primarily renally excreted; monitor closely"

  - id: tiotropium_elderly
    source_id: tiotropium
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Anticholinergic effects more pronounced in elderly"

  # Anticoagulant dose restrictions
  - id: warfarin_elderly
    source_id: warfarin
    target_id: age_over_65
    dose_category: reduced
    strength: strong
    evidence: "Increased bleeding risk; lower doses often needed"

  - id: warfarin_hepatic
    source_id: warfarin
    target_id: hepatic_impairment
    dose_category: reduced
    strength: strong
    evidence: "Impaired synthesis of clotting factors; increased bleeding risk"

  - id: apixaban_elderly
    source_id: apixaban
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Dose reduction if age ≥80 or weight ≤60kg"

  - id: apixaban_ckd
    source_id: apixaban
    target_id: chronic_kidney_disease
    dose_category: reduced
    strength: strong
    evidence: "Dose reduction required for moderate to severe CKD"

  - id: metoprolol_copd
    source_id: metoprolol
    target_id: copd
    dose_category: severely_restricted
    strength: strong
    evidence: "Cardioselective beta blocker; use with extreme caution in COPD"

  - id: metoprolol_elderly
    source_id: metoprolol
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Increased sensitivity to beta blockade effects"

  - id: metoprolol_hepatic
    source_id: metoprolol
    target_id: hepatic_impairment
    dose_category: reduced
    strength: moderate
    evidence: "Extensively hepatically metabolized; reduce dose"

  - id: metoprolol_pregnancy
    source_id: metoprolol
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Monitor fetal growth; potential for bradycardia"

  - id: budesonide_elderly
    source_id: budesonide
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased risk of pneumonia in elderly COPD patients"

  # Antiplatelet dose restrictions
  - id: aspirin_elderly
    source_id: aspirin
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased bleeding risk; monitor for GI bleeding"

  - id: aspirin_ckd
    source_id: aspirin
    target_id: chronic_kidney_disease
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased bleeding risk and reduced platelet function"

  - id: clopidogrel_elderly
    source_id: clopidogrel
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased bleeding risk in elderly"

  - id: clopidogrel_ckd
    source_id: clopidogrel
    target_id: chronic_kidney_disease
    dose_category: use_with_caution
    strength: moderate
    evidence: "Monitor for bleeding; no dose adjustment needed"

  # Statin dose restrictions
  - id: atorvastatin_elderly
    source_id: atorvastatin
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased risk of myopathy; start with lower doses"

  - id: atorvastatin_ckd
    source_id: atorvastatin
    target_id: chronic_kidney_disease
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased myopathy risk in advanced CKD"

  - id: atorvastatin_pregnancy
    source_id: atorvastatin
    target_id: pregnant
    dose_category: avoid_if_possible
    strength: absolute
    evidence: "Contraindicated; teratogenic effects"

  # Thyroid hormone restrictions
  - id: levothyroxine_elderly
    source_id: levothyroxine
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Start with lower doses; increased sensitivity in elderly"

  - id: levothyroxine_coronary
    source_id: levothyroxine
    target_id: coronary_artery_disease
    dose_category: reduced
    strength: strong
    evidence: "Start low, go slow; may precipitate angina or MI"

  - id: levothyroxine_pregnancy
    source_id: levothyroxine
    target_id: pregnant
    dose_category: use_with_caution
    strength: moderate
    evidence: "Often needs dose increase during pregnancy; monitor TSH"

  # SSRI dose restrictions
  - id: sertraline_elderly
    source_id: sertraline
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Increased hyponatremia risk; start with lower doses"

  - id: fluoxetine_elderly
    source_id: fluoxetine
    target_id: age_over_65
    dose_category: reduced
    strength: moderate
    evidence: "Long half-life; increased hyponatremia risk"

  - id: sertraline_hepatic
    source_id: sertraline
    target_id: hepatic_impairment
    dose_category: reduced
    strength: moderate
    evidence: "Reduced clearance; lower dose required"

  - id: fluoxetine_hepatic
    source_id: fluoxetine
    target_id: hepatic_impairment
    dose_category: reduced
    strength: moderate
    evidence: "Long half-life further prolonged; reduce dose"

  - id: sertraline_ckd
    source_id: sertraline
    target_id: chronic_kidney_disease
    dose_category: use_with_caution
    strength: moderate
    evidence: "Monitor closely; generally safe but caution advised"

  # TB medication dose restrictions
  - id: rifampin_elderly
    source_id: rifampin
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Monitor hepatic function closely"

  - id: isoniazid_elderly
    source_id: isoniazid
    target_id: age_over_65
    dose_category: use_with_caution
    strength: moderate
    evidence: "Increased hepatotoxicity risk; monitor LFTs"

  - id: rifampin_ckd
    source_id: rifampin
    target_id: chronic_kidney_disease
    dose_category: use_with_caution
    strength: moderate
    evidence: "Monitor for adverse effects; dose adjustment may be needed"

  - id: isoniazid_ckd
    source_id: isoniazid
    target_id: chronic_kidney_disease
    dose_category: reduced
    strength: moderate
    evidence: "Dose adjustment required in severe renal impairment"
