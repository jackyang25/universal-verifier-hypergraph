<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Protocol Hypergraph</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <header>
        <div class="header-left">
            <h1>Universal Protocol Hypergraph</h1>
            <p class="subtitle">Clinical safety system through Lean-based verification</p>
        </div>
    </header>

    <!-- Main EMR-style form -->
    <main class="emr-main">
        <div class="emr-container">
            <!-- Two Column Layout -->
            <div class="unified-panel">
                <div class="two-column-layout">
                    <!-- Left Column: Verification Inputs -->
                    <div class="left-column">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h2>Verification Inputs</h2>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0;">
                                <div class="tabs">
                                    <button class="tab-btn active" data-tab="conformal">
                                        <span class="tab-label">Conformal Set</span>
                                    </button>
                                    <button class="tab-btn" data-tab="context">
                                        <span class="tab-label">Patient Context</span>
                                    </button>
                                    <button class="tab-btn" data-tab="action">
                                        <span class="tab-label">Proposed Action</span>
                                    </button>
                                </div>
                                <div class="tab-content">
                                    <!-- Tab 1: Conformal Set -->
                                    <div id="tab-conformal" class="tab-pane active">
                                        <div class="pill-section">
                                            <div class="pill-hint">Select conditions for the conformal prediction set</div>
                                            <div id="conditions-disorders" class="pill-container"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tab 2: Proposed Action -->
                                    <div id="tab-action" class="tab-pane">
                                        <div class="pill-section">
                                            <div class="label-title" style="margin-bottom: 0.75rem;">Action Type</div>
                                            <div class="action-type-segmented">
                                                <button type="button" class="segment-btn" data-action-type="substance" id="action-type-substance">
                                                    <span>üíä Medication</span>
                                                </button>
                                                <button type="button" class="segment-btn" data-action-type="action" id="action-type-action">
                                                    <span>üßë‚Äç‚öïÔ∏è Clinical Action</span>
                                                </button>
                                            </div>
                                            
                                            <div id="substance-select" class="hidden" style="margin-top: 1.5rem;">
                                                <div class="label-title" style="margin-bottom: 0.75rem;">Select Medication</div>
                                                <div id="substance-pills" class="pill-container"></div>
                                                <label class="input-label-block" style="margin-top: 1rem;">
                                                    <span class="label-title">Dose</span>
                                                    <input type="text" id="substance-dose" class="text-input" placeholder="e.g., 20mg IV bolus">
                                                </label>
                                            </div>
                                            
                                            <div id="action-select" class="hidden" style="margin-top: 1.5rem;">
                                                <div class="label-title" style="margin-bottom: 0.75rem;">Select Action</div>
                                                <div id="action-pills" class="pill-container"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tab 3: Patient Context -->
                                    <div id="tab-context" class="tab-pane">
                                        <div class="pill-section">
                                            <div class="label-title" style="margin-bottom: 0.75rem;">Comorbidities</div>
                                            <div id="context-comorbidities" class="pill-container"></div>
                                            
                                            <div class="label-title" style="margin-bottom: 0.75rem; margin-top: 1.5rem;">Physiologic States</div>
                                            <div id="context-states" class="pill-container"></div>
                                            
                                            <div style="margin-top: 1.5rem;">
                                                <div class="label-title" style="margin-bottom: 1rem;">
                                                    Gestational Age
                                                    <span id="ga-weeks-display" class="ga-display-value">Not set</span>
                                                </div>
                                                <div class="ga-slider-container">
                                                    <div class="ga-slider-labels">
                                                        <span class="ga-label">20w</span>
                                                        <span class="ga-label">28w</span>
                                                        <span class="ga-label">34w</span>
                                                        <span class="ga-label">37w</span>
                                                        <span class="ga-label">42w</span>
                                                    </div>
                                                    <input type="range" id="ga-weeks" class="ga-slider" min="20" max="42" step="1" value="">
                                                    <div class="ga-range-indicators">
                                                        <div class="ga-range preterm" title="Preterm (20-37 weeks)"></div>
                                                        <div class="ga-range term" title="Term (37-42 weeks)"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tab 3: Proposed Action -->
                                    <div id="tab-action" class="tab-pane">
                                        <div class="pill-section">
                                            <div class="label-title" style="margin-bottom: 0.75rem;">Action Type</div>
                                            <div class="action-type-segmented">
                                                <button type="button" class="segment-btn" data-action-type="substance" id="action-type-substance">
                                                    <span>üíä Medication</span>
                                                </button>
                                                <button type="button" class="segment-btn" data-action-type="action" id="action-type-action">
                                                    <span>‚öïÔ∏è Clinical Action</span>
                                                </button>
                                            </div>
                                            
                                            <div id="substance-select" class="hidden" style="margin-top: 1.5rem;">
                                                <div class="label-title" style="margin-bottom: 0.75rem;">Select Medication</div>
                                                <div id="substance-pills" class="pill-container"></div>
                                                <label class="input-label-block" style="margin-top: 1rem;">
                                                    <span class="label-title">Dose</span>
                                                    <input type="text" id="substance-dose" class="text-input" placeholder="e.g., 20mg IV bolus">
                                                </label>
                                            </div>
                                            
                                            <div id="action-select" class="hidden" style="margin-top: 1.5rem;">
                                                <div class="label-title" style="margin-bottom: 0.75rem;">Select Action</div>
                                                <div id="action-pills" class="pill-container"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Results -->
                    <div class="right-column">
                        <div id="results-section" class="card">
                            <div class="card-header">
                                <div style="flex: 1;">
                                    <h2>Verification Certificate</h2>
                                    <span class="card-subtitle">Safety verification result</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span id="verification-status-badge" class="status-badge status-pending">PENDING</span>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0;">
                                <div class="tabs">
                                    <button class="tab-btn active" data-tab="violations">
                                        <span class="tab-label">Violations</span>
                                    </button>
                                    <button class="tab-btn" data-tab="alternatives">
                                        <span class="tab-label">Alternatives</span>
                                    </button>
                                </div>
                                <div class="tab-content" id="results-tab-content">
                                    <div id="tab-violations" class="tab-pane active">
                                        <div style="padding: 1.5rem;">
                                            <p id="results-empty" class="empty-state" style="padding: 2.5rem 2rem;">Enter conformal set, proposed action, and patient context, then click "Verify Safety".</p>
                                            <div id="cert-contraindications" class="cert-section"></div>
                                            <div id="cert-requirements" class="cert-section"></div>
                                            <div id="cert-consistency" class="cert-section"></div>
                                        </div>
                                    </div>
                                    <div id="tab-alternatives" class="tab-pane">
                                        <div style="padding: 1.5rem;">
                                            <div id="cert-alternatives" class="cert-section"></div>
                                            <div id="cert-dose-limits" class="cert-section"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Protocol Graph Section (spans full width) -->
            <div id="graph-section" class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <h2>Protocol Hypergraph Visualization</h2>
                    <div class="card-header-actions">
                        <button id="clear-btn" class="btn-secondary">Clear All</button>
                        <button id="route-btn" class="btn-primary">Verify Safety</button>
                        <button id="toggle-graph-btn" class="btn-secondary">
                            <span id="graph-toggle-text">Hide Graph</span>
                        </button>
                    </div>
                </div>
                <div id="graph-body" class="card-body" style="padding: 0;">
                    <div id="visualization">
                        <svg id="graph"></svg>
                        <div id="tooltip" class="hidden"></div>
                    </div>
                </div>
                <div id="graph-info" class="graph-info-panel">
                    <p>Nodes: <span id="condition-count">0</span></p>
                    <p>Hyperedges: <span id="protocol-count">0</span></p>
                    <p>Config Version: <span id="config-version">-</span></p>
                </div>
                
                <!-- Audit Trail Panel (inside graph section) -->
                <div id="audit-panel" class="audit-panel">
                    <div class="audit-panel-header">
                        <h3>Execution Trail</h3>
                    </div>
                    <div class="audit-panel-body">
                        <div id="audit-pills" class="audit-pills"></div>
                        <div id="audit-details" class="audit-details"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>


    <script src="/static/js/api-client.js"></script>
    <script src="/static/js/graph-renderer.js"></script>
    <script src="/static/js/resize-handler.js"></script>
    <script src="/static/js/playground-controls.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
